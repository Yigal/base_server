{% extends "base.html" %}

{% block page_title %}Events{% endblock %}

{% block content %}
<div class="events-container-main">
    <div class="events-header">
        <h2>Recent Server Events</h2>
        <button id="refreshBtn" class="btn-refresh" onclick="refreshEvents()">ðŸ”„ Refresh</button>
        <span id="lastRefresh" class="last-refresh">Loading...</span>
    </div>

    <p class="events-description">Last 100 API calls with request and response details</p>

    <div id="events-container" class="events-container">
        <p class="loading">Loading events...</p>
    </div>
</div>

<script>
// Load events on page load
document.addEventListener('DOMContentLoaded', async () => {
    try {
        const data = await loadEvents();
        if (data && data.events) {
            displayEvents(data.events);
            document.getElementById('lastRefresh').textContent = 'Last refresh: ' + new Date().toLocaleTimeString();
        }
    } catch (error) {
        console.error('Error loading events:', error);
        showError('events-container', `Failed to load events: ${error.message}`);
    }

    // Auto-refresh every 5 seconds
    setInterval(async () => {
        try {
            const data = await loadEvents();
            if (data && data.events) {
                displayEvents(data.events);
                document.getElementById('lastRefresh').innerHTML =
                    `<span class="refresh-indicator"></span>Last refresh: ${new Date().toLocaleTimeString()}`;
            }
        } catch (error) {
            console.error('Auto-refresh error:', error);
        }
    }, 5000);
});
</script>
{% endblock %}
